The code I'm giving you uses Libcloud API, but it is very much designed for the Rackspace Cloud driver implementation. I know for a fact, through building other tools, that other provider drivers such as Linode have differing requirements (Linode, for example, requires you to also specify a datacentre to build in). Please don't contact me complaining that it didn't work with Provider X, because I'm just showing you how we use it with Rackspace. Since there's a good chance you're smarter than me, you're welcome to take the code and abstract it properly :)

The code is far from perfect because I'm rather crap at such things. The error handling is extremely crude.


1) Create a new Rackspace server (lucid lynx 10.04 for example)
2) Log in as root

3) All commands to be performed as root:

apt-get install git-core
git clone git://github.com/apache/libcloud.git
apt-get install python-setuptools
git clone git://github.com/sarapis/aegir_ci.git
cd libcloud
python setup.py install
apt-get install fabric
cd ..

4) 

a) email - this is your personal email from which you will control aegir
b) your rackspace username that you normally log into rackspace with
c) your rackspace API key

https://manage.rackspacecloud.com/APIAccess.do
Show key

It's at this point that you want to edit the aegir_6.x-1.1_install.py file and define what to build. In my example that I'm giving you, I'm fetching three Drush make stub or 'build' files from my github repo, named drupal6, drupal7 and openatrium .build respectively.

The code that does this is the function fab_install_platform().

Thus, this code is very much specific to building your project from a makefile, the fact that the makefile is fetchable over HTTP (per the ini config file, it fetches from my github repo) and also makes some assumptions on what install profile to use when installing the site.

The code that installs the site is the function fab_install_site(), and takes two arguments: the platform per the above (e.g drupal6, drupal7 or openatrium), and the install profile name (default, standard or openatrium in this example). So this is where you want to change the install profile name and only install whatever platforms you want, based on the name of your makefile.

Aegir should should send you an email with a one-time login, at which point you may choose to enable more Aegir features such as:

migration
cloning
aliasing

You can do that here: http://xx-xx-xxx-xx.static.cloud-ips.com/admin/hosting/features

Don't forget that to make domain names work properly you should create A records (at Rackspace) and site aliases (in Aegir) as well as get your registrar stuff sorted out in advance or else you'll have to wait through the DNS propagation time